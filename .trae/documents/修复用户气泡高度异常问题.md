# 问题分析

找到用户气泡高度异常的根本原因：

## 问题根源

在 `ChatBubble` 类的用户气泡部分（role == "User"）：

```python
avatar_layout = QVBoxLayout(avatar_container)
avatar_layout.setContentsMargins(0, 5, 0, 0)
avatar_layout.setSpacing(0)
avatar_layout.addWidget(avatar)
avatar_layout.addStretch()  # 问题在这里！
```

`avatar_layout.addStretch()` 会让 `avatar_container` 尽可能扩展高度，从而将整个用户气泡的高度撑大。

## 解决方案

移除 `avatar_layout.addStretch()`，让 `avatar_container` 的高度只由 `Avatar` 控件决定。

## 具体修改

修改 `ChatBubble.__init__` 方法中用户气泡的 avatar_container 布局：

```python
# 修改前
avatar_layout.addWidget(avatar)
avatar_layout.addStretch()

# 修改后
avatar_layout.addWidget(avatar)
# 移除addStretch()，让容器高度只由Avatar决定
```

这样 `avatar_container` 的高度将固定为 `Avatar` 的大小（40px），不会扩展。